---
title: "Building a Customer Service Agent"
description: "Step-by-step tutorial for creating a SOFIA-powered customer service agent"
---

# Building a Customer Service Agent

This tutorial will guide you through creating a complete customer service agent using SOFIA. By the end, you'll have a functional agent that can handle common customer service scenarios, from greeting customers to resolving issues.

## What We'll Build

We'll create a customer service agent that can:

1. Greet customers and identify their issues
2. Handle common queries about products, orders, and returns
3. Troubleshoot technical problems
4. Escalate to human support when necessary
5. Capture customer feedback

<div className="my-6">
  <img 
    src="/images/customer-service-flow-diagram.png" 
    alt="Customer service agent flow diagram" 
    className="rounded-lg border border-gray-200 dark:border-gray-800 w-full"
  />
</div>

## Prerequisites

Before starting this tutorial, make sure you have:

- SOFIA installed (follow the [installation guide](/docs/getting-started/installation))
- Basic understanding of SOFIA concepts (review [core concepts](/docs/concepts/architecture))
- Python 3.8+ and a text editor
- (Optional) A sample product database or API for lookups

## Step 1: Setting Up the Project

First, let's create a project directory and set up our environment:

```bash
# Create project directory
mkdir customer-service-agent
cd customer-service-agent

# Create virtual environment (optional but recommended)
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install SOFIA and other requirements
pip install sofia-agent python-dotenv
```

Now, create these files in your project directory:

1. `tools.py` - Will contain our custom tools
2. `agent.py` - Will contain our agent configuration
3. `config.yaml` - YAML configuration (alternative to Python)
4. `.env` - For environment variables (API keys, etc.)

## Step 2: Creating Custom Tools

First, let's create some custom tools our agent will use. Open `tools.py` and add:

```python
from sofia_agent import Tool
from typing import Dict, List, Optional
import json
import os

# Simulated product database (in a real scenario, this would be a database or API)
PRODUCTS = [
    {"id": "p001", "name": "Wireless Headphones", "price": 99.99, "category": "Electronics", "in_stock": True},
    {"id": "p002", "name": "Running Shoes", "price": 129.99, "category": "Footwear", "in_stock": True},
    {"id": "p003", "name": "Smart Watch", "price": 199.99, "category": "Electronics", "in_stock": False},
    {"id": "p004", "name": "Yoga Mat", "price": 29.99, "category": "Fitness", "in_stock": True},
]

# Simulated order database
ORDERS = [
    {"id": "o001", "customer_id": "c001", "products": ["p001"], "status": "Delivered", "date": "2023-10-15"},
    {"id": "o002", "customer_id": "c002", "products": ["p002", "p004"], "status": "Processing", "date": "2023-11-01"},
    {"id": "o003", "customer_id": "c001", "products": ["p003"], "status": "Backordered", "date": "2023-11-05"},
]

# Tool functions
def search_products(query: str, category: Optional[str] = None) -> List[Dict]:
    """Search for products by name or category."""
    results = []
    query = query.lower()
    
    for product in PRODUCTS:
        if (query in product["name"].lower() or (category and category.lower() == product["category"].lower())):
            results.append(product)
    
    return results

def check_order_status(order_id: str) -> Dict:
    """Check the status of an order by ID."""
    for order in ORDERS:
        if order["id"] == order_id:
            # Get product details for the order
            order_products = []
            for product_id in order["products"]:
                for product in PRODUCTS:
                    if product["id"] == product_id:
                        order_products.append(product)
            
            return {
                "order": order,
                "products": order_products
            }
    
    return {"error": "Order not found"}

def get_return_policy(product_category: Optional[str] = None) -> Dict:
    """Get return policy information, optionally filtered by product category."""
    policies = {
        "Electronics": "30-day return period. Must be in original packaging with all accessories.",
        "Footwear": "60-day return period. Unworn condition with original box.",
        "Fitness": "14-day return period. Must be unused and in original packaging.",
        "default": "Standard 30-day return policy applies to most items. See website for details."
    }
    
    if product_category and product_category in policies:
        return {"category": product_category, "policy": policies[product_category]}
    return {"policy": policies["default"]}

def create_support_ticket(customer_id: str, issue: str, priority: str = "medium") -> Dict:
    """Create a support ticket for escalation to human support."""
    # In a real implementation, this would interface with a ticketing system
    ticket_id = f"T{len(customer_id)}{len(issue)}{hash(issue) % 1000:03d}"
    
    return {
        "ticket_id": ticket_id,
        "customer_id": customer_id,
        "issue": issue,
        "priority": priority,
        "status": "Created",
        "assigned_to": "Support Team"
    }

def save_customer_feedback(customer_id: str, feedback: str, rating: int) -> Dict:
    """Save customer feedback and rating."""
    # In a real implementation, this would save to a database
    return {
        "customer_id": customer_id,
        "feedback": feedback,
        "rating": rating,
        "status": "Received",
        "timestamp": "Current time would go here"
    }

# Create SOFIA tools
product_search_tool = Tool(
    name="product_search",
    function=search_products,
    description="Search for products by name or category"
)

order_status_tool = Tool(
    name="order_status",
    function=check_order_status,
    description="Check the status of an order by order ID"
)

return_policy_tool = Tool(
    name="return_policy",
    function=get_return_policy,
    description="Get information about return policies"
)

support_ticket_tool = Tool(
    name="create_ticket",
    function=create_support_ticket,
    description="Create a support ticket for human follow-up"
)

feedback_tool = Tool(
    name="save_feedback",
    function=save_customer_feedback,
    description="Save customer feedback and rating"
)

# Export all tools
all_tools = [
    product_search_tool,
    order_status_tool,
    return_policy_tool,
    support_ticket_tool,
    feedback_tool
]
```

## Step 3: Creating the Agent Configuration

Now, let's create our agent configuration in `config.yaml`:

```yaml
name: Customer Service Agent
description: A helpful customer service agent for handling product inquiries, orders, and support

steps:
  - id: greeting
    prompt: |
      You are a friendly and helpful customer service agent.
      Greet the customer warmly and ask how you can assist them today.
      Be conversational and personable.
    next: identify_issue
    
  - id: identify_issue
    prompt: |
      Listen carefully to the customer's issue.
      Try to determine what kind of help they need.
    routes:
      - when: Customer is asking about a product or products
        goto: product_inquiry
      - when: Customer is asking about an order
        goto: order_inquiry
      - when: Customer has questions about returns or refunds
        goto: return_policy
      - when: Customer needs technical support
        goto: technical_support
      - when: Customer wants to provide feedback
        goto: feedback
      - default: general_help
        
  - id: product_inquiry
    prompt: |
      The customer is asking about a product. 
      Ask for specific details about what they're looking for.
      If they mention a specific product or category, use the product search tool.
    tool: product_search
    routes:
      - when: Products found
        goto: present_products
      - when: No products found
        goto: no_products_found
        
  - id: present_products
    prompt: |
      Present the product information in a helpful, organized way.
      Include details like price, availability, and features.
      Ask if the customer would like more information or has other questions.
    routes:
      - when: Customer wants to purchase
        goto: purchase_guidance
      - when: Customer asks about another product
        goto: product_inquiry
      - when: Customer has order questions
        goto: order_inquiry
      - default: anything_else
        
  - id: no_products_found
    prompt: |
      Apologize that you couldn't find products matching their criteria.
      Suggest alternatives or ask if they'd like to explore other categories.
    next: anything_else
    
  - id: purchase_guidance
    prompt: |
      Provide guidance on how to purchase the product.
      Explain payment options, shipping, and the checkout process.
      Ask if they need any clarification.
    next: anything_else
    
  - id: order_inquiry
    prompt: |
      The customer is asking about an order.
      Ask for their order ID to look up details.
    next: check_order
    
  - id: check_order
    prompt: |
      Use the order status tool to check the order status.
      Be prepared to handle both found and not found scenarios.
    tool: order_status
    routes:
      - when: Order found
        goto: present_order
      - when: Order not found
        goto: order_not_found
        
  - id: present_order
    prompt: |
      Present the order information clearly.
      Include status, products, and expected delivery date if available.
      For delayed or backordered items, offer an explanation and apology.
    routes:
      - when: Customer has a problem with their order
        goto: order_issue
      - default: anything_else
        
  - id: order_not_found
    prompt: |
      Apologize that you couldn't find the order.
      Suggest possible reasons (typo in order ID, recent order not in system yet).
      Offer to help look up by other means or create a support ticket.
    routes:
      - when: Customer wants to create a support ticket
        goto: create_ticket
      - default: anything_else
        
  - id: order_issue
    prompt: |
      Listen to the customer's issue with their order.
      Determine if it's something you can resolve or if it needs human assistance.
    routes:
      - when: Issue needs human assistance
        goto: create_ticket
      - when: Issue is about returns
        goto: return_policy
      - default: resolve_simple_issue
        
  - id: resolve_simple_issue
    prompt: |
      Attempt to resolve the customer's simple order issue.
      Provide clear steps they can take or explain policies that apply.
    next: anything_else
    
  - id: return_policy
    prompt: |
      The customer has questions about returns or refunds.
      Ask if they're inquiring about a specific product category or the general policy.
    tool: return_policy
    next: present_return_policy
    
  - id: present_return_policy
    prompt: |
      Explain the return policy clearly.
      Provide steps for initiating a return if applicable.
      Ask if they need any clarification or have other questions.
    next: anything_else
    
  - id: technical_support
    prompt: |
      The customer needs technical support.
      Ask what product they're having issues with and what specific problems they're experiencing.
    next: troubleshoot
    
  - id: troubleshoot
    prompt: |
      Based on the customer's description, provide troubleshooting steps.
      Start with the simplest solutions first.
      If the issue seems complex, offer to create a support ticket.
    routes:
      - when: Issue is beyond troubleshooting
        goto: create_ticket
      - default: anything_else
        
  - id: create_ticket
    prompt: |
      Explain that you'll create a support ticket for human follow-up.
      Ask for any details needed for the ticket (if not already provided).
    tool: create_ticket
    next: ticket_created
    
  - id: ticket_created
    prompt: |
      Confirm the ticket has been created and provide the ticket ID.
      Explain when and how they can expect a response.
      Express empathy for their issue and appreciation for their patience.
    next: anything_else
    
  - id: feedback
    prompt: |
      The customer wants to provide feedback.
      Ask them to share their experience and a rating from 1-5.
    next: process_feedback
    
  - id: process_feedback
    prompt: |
      Thank the customer for their feedback.
      Use the feedback tool to record their comments and rating.
    tool: save_feedback
    next: feedback_received
    
  - id: feedback_received
    prompt: |
      Confirm that their feedback has been recorded.
      Thank them for taking the time to share their thoughts.
      If the feedback was negative, express empathy and assure them it will be addressed.
    next: anything_else
    
  - id: general_help
    prompt: |
      Provide general assistance based on the customer's query.
      If you're unsure how to help, explain what services you can provide.
    next: anything_else
    
  - id: anything_else
    prompt: |
      Ask if there's anything else the customer needs help with today.
    routes:
      - when: Customer needs more help
        goto: identify_issue
      - default: farewell
        
  - id: farewell
    prompt: |
      Thank the customer for contacting customer service.
      Wish them a nice day and encourage them to reach out again if they need anything.
      Sign off as the customer service agent.
```

## Step 4: Implementing the Agent Script

Now, let's create the Python script that will run our agent. Create `agent.py`:

```python
import os
from dotenv import load_dotenv
from sofia_agent import Sofia
from sofia_agent.config import load_config_from_yaml
from tools import all_tools

# Load environment variables
load_dotenv()

def create_agent_from_yaml():
    """Create the customer service agent from YAML config."""
    # Load configuration from YAML
    config = load_config_from_yaml("config.yaml")
    
    # Create the agent with our custom tools
    agent = Sofia(
        name=config["name"],
        description=config["description"],
        steps=config["steps"],
        tools=all_tools,
        llm_provider="openai",  # Or "mistral", "google", etc.
        model="gpt-3.5-turbo"   # Adjust based on your provider
    )
    
    return agent

def create_agent_programmatically():
    """Alternative: Create the agent using Python code instead of YAML."""
    from sofia_agent import Sofia, Step, Route
    
    # This function shows how to create the same agent using Python code
    # instead of loading from YAML.
    # This is included as a reference but we'll use the YAML version.
    
    agent = Sofia(
        name="Customer Service Agent",
        description="A helpful customer service agent for handling product inquiries, orders, and support",
        steps=[
            Step(
                id="greeting",
                prompt="You are a friendly and helpful customer service agent.\nGreet the customer warmly and ask how you can assist them today.\nBe conversational and personable.",
                next="identify_issue"
            ),
            # Add all other steps here similar to the YAML
            # ...
        ],
        tools=all_tools,
        llm_provider="openai",
        model="gpt-3.5-turbo"
    )
    
    return agent

def run_agent():
    """Run the customer service agent in CLI mode."""
    agent = create_agent_from_yaml()
    
    print("\n===== Customer Service Agent =====\n")
    print("Type 'exit' or 'quit' to end the conversation.\n")
    
    # Start a new session
    session = agent.new_session()
    
    # Simulate agent's greeting
    response = agent.generate(session=session)
    print(f"Agent: {response}")
    
    # Main conversation loop
    while True:
        # Get user input
        user_input = input("\nYou: ").strip()
        
        # Check for exit command
        if user_input.lower() in ["exit", "quit", "bye"]:
            print("\nAgent: Thank you for contacting customer service. Have a great day!")
            break
        
        # Generate agent response
        response = agent.generate(user_input, session=session)
        print(f"\nAgent: {response}")

if __name__ == "__main__":
    run_agent()
```

## Step 5: Running Your Agent

Now that we have everything set up, let's run our customer service agent:

```bash
# Make sure you're in the project directory with venv activated
python agent.py
```

You should see a greeting from your agent, and you can start interacting with it.

## Example Conversations

Here are some example interactions you can try with your agent:

### Product Inquiry

```
Agent: Hello! Welcome to our customer service. My name is Alex. How can I help you today?

You: Do you have any wireless headphones?

Agent: I'd be happy to help you find wireless headphones! Let me search for those products for you.

We have the following wireless headphones available:
- Wireless Headphones (ID: p001)
- Price: $99.99
- Category: Electronics
- In Stock: Yes

Would you like more information about these headphones, or do you have any other questions about them?
```

### Order Status Check

```
You: I want to check on my order

Agent: I'd be happy to help you check on your order. Could you please provide your order ID? It should be something like "o001" and would have been included in your order confirmation email.

You: o002

Agent: Thank you for providing your order ID. Let me look that up for you.

Here are the details for your order o002:

Status: Processing
Order Date: 2023-11-01
Products:
- Running Shoes ($129.99)
- Yoga Mat ($29.99)

Your order is currently being processed and prepared for shipping. Is there anything specific about this order that you'd like to know?
```

## Step 6: Extending the Agent

Now that you have a basic customer service agent, you can extend it in several ways:

### Add More Tools

Enhance the agent's capabilities by adding tools for:
- Subscription management
- Address updates
- Coupon code validation
- Product recommendations

### Improve Error Handling

Add more robust error handling for edge cases:
- Multiple orders with similar IDs
- Products with variations (sizes, colors)
- Incomplete customer information

### Connect to Real Systems

Replace the simulated databases with connections to real systems:
- E-commerce platform APIs
- CRM systems
- Ticketing solutions
- Inventory management

## Conclusion

Congratulations! You've built a functional customer service agent using SOFIA. This agent demonstrates many of SOFIA's core features:

- Multi-step conversation flows
- Decision-making with routes
- Tool integration for external actions
- Complex state management

As you continue to work with SOFIA, you can make your agent more sophisticated by adding more tools, refining prompts, and integrating with real business systems.

## Next Steps

To continue your SOFIA journey:

- Try the [Data Analysis Assistant](/docs/tutorials/data-analysis-assistant) tutorial
- Learn how to [deploy your agent](/docs/guides/deployment)
- Explore [advanced configuration options](/docs/guides/configuration)
- Join our [community forum](https://github.com/sofia-ai/sofia/discussions) to share your agent
