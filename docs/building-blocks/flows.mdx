---
title: 'Flows'
description: 'Learn how to organize complex agent workflows using flows in NOMOS'
icon: 'group'
---

NOMOS provides advanced flow management capabilities that allow you to organize related steps into logical groups with shared context and components. Flows are perfect for complex workflows that require stateful interactions, context preservation, and intelligent transitions between different parts of your agent's behavior.

## What are Flows?

Flows are containers that group related steps together and provide:

<CardGroup cols={2}>
  <Card
    title="Shared Memory"
    icon="brain"
  >
    Each flow maintains its own context that persists across steps within the flow
  </Card>
  <Card
    title="Component Management"
    icon="puzzle-piece"
  >
    Flows can have dedicated components like memory systems, specialized tools, or custom handlers
  </Card>
  <Card
    title="Context Transfer"
    icon="arrows-turn-right"
  >
    When transitioning between flows, context is intelligently summarized and passed along
  </Card>
  <Card
    title="Entry/Exit Points"
    icon="door-open"
  >
    Define which steps can enter or exit a flow for better control flow management
  </Card>
</CardGroup>

## Flow Configuration

You can define flows in your YAML configuration:

```yaml
# Basic agent configuration
name: advanced-assistant
persona: A helpful assistant with specialized workflows
start_step_id: greeting

steps:
  - step_id: greeting
    description: Greet the user and understand their needs
    routes:
      - target: order_taking
        condition: User wants to place an order
      - target: customer_support
        condition: User needs help or support

  - step_id: order_taking
    description: Handle order details and preferences
    available_tools:
      - get_menu_items
      - add_to_cart
    routes:
      - target: order_confirmation
        condition: Order is complete

  - step_id: order_confirmation
    description: Confirm order details and process payment
    available_tools:
      - calculate_total
      - process_payment
    routes:
      - target: farewell
        condition: Order is confirmed

  - step_id: customer_support
    description: Handle customer inquiries and issues
    available_tools:
      - search_knowledge_base
      - escalate_to_human
    routes:
      - target: farewell
        condition: Issue is resolved

  - step_id: farewell
    description: Thank the user and end the conversation

# Enhanced flows configuration
flows:
  - flow_id: order_management
    description: "Complete order processing workflow"
    enters:
      - order_taking
    exits:
      - order_confirmation
      - farewell
    components:
      memory:
        llm:
          provider: openai
          model: gpt-4o-mini
        retriever:
          method: embedding
          kwargs:
            k: 5
    metadata:
      max_context_size: 50
      summary_threshold: 20

  - flow_id: support_workflow
    description: "Customer support and issue resolution"
    enters:
      - customer_support
    exits:
      - farewell
    components:
      memory:
        llm:
          provider: openai
          model: gpt-4o-mini
        retriever:
          method: embedding
    metadata:
      max_context_size: 30
      summary_threshold: 15
```

## Flow Memory and Context

Each flow can have its own memory system that:

<AccordionGroup>
  <Accordion title="Preserves Context">
    Maintains conversation history and important details within the flow
  </Accordion>
  <Accordion title="Intelligent Retrieval">
    Uses BM25 or other retrieval methods to find relevant information
  </Accordion>
  <Accordion title="Context Summarization">
    Automatically summarizes context when exiting a flow
  </Accordion>
  <Accordion title="Cross-Flow Transfer">
    Passes summarized context when transitioning between flows
  </Accordion>
</AccordionGroup>

## Flow Benefits

<Tabs>
  <Tab title="Architecture">
    **Organized Architecture**: Keep related functionality grouped together

    Flows help you organize your agent's capabilities into logical groups, making your codebase more maintainable and easier to understand.
  </Tab>
  <Tab title="Context">
    **Context Awareness**: Maintain relevant information throughout related interactions

    Each flow maintains its own context, ensuring that relevant information persists throughout the workflow.
  </Tab>
  <Tab title="Scalability">
    **Scalable Design**: Easily extend your agent with new flows without affecting existing ones

    Add new workflows without disrupting existing functionality.
  </Tab>
  <Tab title="Memory">
    **Memory Efficiency**: Each flow only maintains context relevant to its purpose

    Optimize memory usage by keeping only relevant context within each flow.
  </Tab>
  <Tab title="Control">
    **Flexible Transitions**: Define precise entry and exit conditions for better control flow

    Control exactly when and how users can transition between different workflows.
  </Tab>
</Tabs>

## Example: Barista Agent with Flows

The barista example demonstrates flow usage for order management:

```yaml
flows:
  - flow_id: take_coffee_order
    description: "Complete coffee ordering process"
    enters:
      - take_coffee_order
    exits:
      - finalize_order
      - end
    components:
      memory:
        llm:
          provider: openai
          model: gpt-4o-mini
        retriever:
          method: embedding
    metadata:
      max_context_size: 50
      summary_threshold: 20
```

<Note>
This flow ensures that all order-related context (customer preferences, cart contents, order history) is maintained throughout the ordering process and properly summarized when the order is complete.
</Note>

## Advanced Flow Patterns

### Multi-Flow Applications

You can create sophisticated applications by combining multiple flows:

```yaml
flows:
  - flow_id: authentication
    description: "User login and verification"
    enters: [login]
    exits: [dashboard, main_menu]

  - flow_id: order_processing
    description: "Handle customer orders"
    enters: [order_taking]
    exits: [checkout, main_menu]

  - flow_id: customer_support
    description: "Handle customer inquiries"
    enters: [support_request]
    exits: [resolution, escalation]
```

### Flow Transitions

<Info>
Flows automatically handle context transfer when users move between different workflows, ensuring seamless user experience while maintaining relevant information.
</Info>

## Flow Implementation Patterns

### Sequential Flows

For processes that must happen in order:

```yaml
flows:
  - flow_id: onboarding_sequence
    description: "Step-by-step user onboarding"
    enters:
      - welcome_new_user
    exits:
      - onboarding_complete
    components:
      memory:
        llm:
          provider: openai
          model: gpt-4o-mini
    metadata:
      max_context_size: 40
      summary_threshold: 15
```

### Parallel Flows

For independent workflows that can run simultaneously:

```yaml
flows:
  - flow_id: order_processing
    description: "Handle order fulfillment"
    enters: [process_order]
    exits: [order_shipped, order_cancelled]

  - flow_id: customer_communication
    description: "Manage customer updates"
    enters: [send_confirmation]
    exits: [communication_complete]
```

### Conditional Flows

For workflows that depend on specific conditions:

```yaml
flows:
  - flow_id: premium_customer_flow
    description: "Enhanced service for premium customers"
    enters: [verify_premium_status]
    exits: [premium_service_complete]
    conditions:
      entry_requirements:
        - customer_tier: "premium"
        - account_status: "active"
```

## Best Practices

<CardGroup cols={2}>
  <Card
    title="Single Responsibility"
    icon="target"
  >
    Each flow should handle one specific type of workflow or business logic
  </Card>
  <Card
    title="Clear Entry Points"
    icon="door-open"
  >
    Define clear conditions for when users should enter each flow
  </Card>
  <Card
    title="Context Management"
    icon="database"
  >
    Keep flow contexts focused and relevant to avoid information overload
  </Card>
  <Card
    title="Exit Strategies"
    icon="door-closed"
  >
    Always provide clear exit paths from each flow
  </Card>
</CardGroup>

## Flow Debugging and Monitoring

### Flow State Tracking

Monitor flow transitions and context:

```python
# Access flow information programmatically
session = agent.create_session()
current_flow = session.state_machine.current_flow
flow_context = session.state_machine.flow_context

print(f"Current flow: {current_flow.flow_id if current_flow else 'None'}")
print(f"Flow memory size: {len(flow_context.memory) if flow_context else 0}")
```

### Debugging Flow Issues

Common flow-related problems and solutions:

<AccordionGroup>
  <Accordion title="Context Not Persisting">
    **Problem**: Information is lost between steps within a flow

    **Solution**: Check flow memory configuration and ensure proper context retention
    ```yaml
    components:
      memory:
        llm:
          provider: openai
          model: gpt-4o-mini
        retriever:
          method: embedding
    metadata:
      max_context_size: 50  # Increase if context is being truncated
      summary_threshold: 20  # Adjust summarization trigger
    ```
  </Accordion>

  <Accordion title="Unexpected Flow Transitions">
    **Problem**: Agent exits or enters flows unexpectedly

    **Solution**: Review entry/exit conditions and ensure they're specific enough
    ```yaml
    enters:
      - specific_step_name  # Be explicit about entry points
    exits:
      - completion_step     # Clear exit conditions
      - error_step
    ```
  </Accordion>

  <Accordion title="Flow Memory Overhead">
    **Problem**: Flows consuming too much memory or processing time

    **Solution**: Optimize memory settings and use appropriate summarization
    ```yaml
    metadata:
      max_context_size: 30     # Reduce context size
      summary_threshold: 10    # Summarize more frequently
    ```
  </Accordion>
</AccordionGroup>

## Flow Testing

Test flows independently:

```yaml
# flow_tests.agent.yaml
unit:
  test_flow_entry:
    context:
      current_step_id: "order_taking"
    input: "I want to order multiple items"
    expectation: "Enters take_coffee_order flow and maintains context"

  test_flow_context_retention:
    context:
      current_step_id: "take_coffee_order"
      flow_context:
        - customer_preferences: "oat milk, extra hot"
        - cart_items: ["medium latte"]
    input: "Add another latte"
    expectation: "Remembers preferences and applies to new item"

  test_flow_exit:
    context:
      current_step_id: "finalize_order"
      flow_context:
        - order_complete: true
    input: "Thank you"
    expectation: "Exits flow and transitions to farewell step"
```
